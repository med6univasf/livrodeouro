<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Livro de Ouro â€” Medicina Turma VI UNIVASF</title>

  <!-- Fontes -->
  <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&family=Playfair+Display:wght@500;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    /* basic */
    :root{
      --verde:#004d40;
      --dourado:#b8860b;
      --dourado-esc:#d4af37;
      --bg:#fff8e1;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Poppins",sans-serif;
      background: linear-gradient(180deg,#fffdf5 0%,#fff8e1 100%), url("https://www.transparenttextures.com/patterns/paper-fibers.png");
      background-blend-mode:multiply;
      color:var(--verde);
      text-align:center;
      -webkit-font-smoothing:antialiased;
    }

    header{padding:36px 16px 8px}
.brasao{
      width:480px;     /* ðŸ”¥ 2x maior */
      max-width:60vw;  /* ðŸ”¥ permite que cresÃ§a mais no celular */
      display:block;
      margin:0 auto 10px;
      filter:drop-shadow(0 6px 18px rgba(0,0,0,0.12));
}

    h1{font-family:'Alex Brush',cursive;font-size:clamp(2.6rem,6.5vw,4.8rem);margin:2px 0;background:linear-gradient(90deg,var(--dourado-esc),var(--dourado));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    h2,h3{margin:6px 0;font-family:'Playfair Display',serif}
    p.lead{max-width:820px;margin:8px auto 0;color:#333}

    /* gallery */
    .galeria{background:rgba(255,255,255,0.75);border-top:2px solid #efe3b1;border-bottom:2px solid #efe3b1;padding:18px;margin:14px auto}
    .fotos{display:flex;gap:12px;overflow-x:auto;justify-content:center;padding:8px}
    .fotos img{max-height:180px;border-radius:10px;box-shadow:0 6px 14px rgba(0,0,0,0.12);flex-shrink:0;transition:transform .25s}
    .fotos img:hover{transform:scale(1.04)}

    /* pix */
    #pix{max-width:720px;margin:18px auto;background:rgba(255,248,225,0.92);padding:18px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.06)}
    #pix img{width:200px;height:200px;object-fit:cover;border-radius:8px;border:2px solid var(--dourado)}
    .copy{margin-top:12px;font-weight:700;color:#333;background:#fffdf4;padding:8px 10px;border-radius:6px;display:inline-block;border:1px solid rgba(212,175,55,0.12)}

    /* nuvem */
    #nuvem{max-width:980px;margin:24px auto;background:rgba(255,248,225,0.88);border-radius:12px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,0.08);border:1px solid rgba(212,175,55,0.12)}
    #nuvem .titulo{color:var(--dourado);font-family:'Playfair Display',serif;margin-bottom:8px;font-size:1.1rem}
    #wordcloud{position:relative;width:100%;height:420px;overflow:hidden}

    .tag{
      position:absolute;
      white-space:nowrap;
      font-weight:700;
      color:var(--dourado-esc);
      text-shadow:0 2px 6px rgba(0,0,0,0.12);
      transition:transform .25s ease,opacity .25s ease;
      cursor:default; user-select:none;
    }
    .tag:hover{transform:scale(1.18);z-index:999}

    footer{margin-top:24px;padding:18px;color:var(--verde);font-weight:600;text-align:center;background:transparent}

    /* responsive */
    @media (max-width:720px){
      #wordcloud{height:340px}
      .brasao{width:160px}
    }
    @media (max-width:420px){
      #wordcloud{height:260px}
    }

    /* tiny loader */
    #wc-msg{color:#666;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <img class="brasao" src="src/assets/Brasao.png" alt="BrasÃ£o da Turma">
    <h1>Livro de Ouro</h1>
    <h2>Turma Matheus Rodrigues Lopes</h2>
    <h3>Medicina Turma VI â€” UNIVASF</h3>
    <p class="lead">Esse Ã© o nosso livro de ouro online! Sua participaÃ§Ã£o farÃ¡ toda diferenÃ§a para celebrarmos juntos esse momento tÃ£o especial. Agradecemos a todos que contribuÃ­ram para nossa formaÃ§Ã£o â€” todos vocÃªs foram essenciais! ðŸ’š</p>
  </header>

  <section class="galeria">
    <h2 style="color:#b8860b">Nossas MemÃ³rias</h2>
    <div class="fotos">
      <img src="src/assets/A1.jpg" alt="Foto 1">
      <img src="src/assets/A2.jpg" alt="Foto 2">
      <img src="src/assets/A3.jpg" alt="Foto 3">
    </div>
  </section>

  <section id="pix">
    <h2 style="color:#b8860b">Contribua com o Baile via PIX</h2>
    <img src="src/assets/qrcode-pix.jpg" alt="QR Code PIX">
    <p style="
  font-size:1rem;
  color:#333;
  margin-top:14px;
  background:#fffdf4;
  padding:10px;
  border-radius:8px;
  border:1px solid rgba(212,175,55,0.25);
">
  <strong style="color:#b8860b;">Dados BancÃ¡rios:</strong><br>
  Bruno Rocha Souza Silva<br>
  <strong>Banco:</strong> C6 S.A.
</p>
   <div class="copy" style="
  margin-top:12px;
  font-weight:600;
  color:#333;
  background:#fffdf4;
  padding:12px;
  border-radius:8px;
  border:1px solid rgba(212,175,55,0.25);
  word-break:break-all;
  white-space:normal;
  text-align:left;
  font-size:0.9rem;
">
  <strong style="color:#b8860b; font-size:1rem;">Copia e cola do PIX:</strong><br><br>
  <span id="pixcode">00020101021126360014br.gov.bcb.pix0114+55819836668485204000053039865802BR5923BRUNO ROCHA SOUZA SILVA6009SAO PAULO622905251K9WCRW5QCZYNM679EAG8MXQZ6304C390</span>
  <br><br>
  <button onclick="copyPix()" style="
    padding:8px 14px;
    border:none;
    border-radius:6px;
    background:#d4af37;
    color:white;
    font-weight:700;
    cursor:pointer;
    width:100%;
  ">Copiar CÃ³digo PIX</button>
     <script>
function copyPix(){
  const txt = document.getElementById("pixcode").innerText;
  navigator.clipboard.writeText(txt).then(()=>{
    alert("CÃ³digo PIX copiado!");
  });
}
</script>
</div>

  </section>

  <section id="nuvem" aria-label="Nuvem de doadores">
    <div class="titulo">Nossos Apoiadores</div>
    <div id="wordcloud" role="img" aria-label="Nuvem de nomes dos doadores"></div>
    <div id="wc-msg">Carregando doadores...</div>
  </section>

  <section id="recados" style="
  max-width: 820px;
  margin: 40px auto;
  padding: 20px;
  background: rgba(255,248,225,0.92);
  border-radius: 12px;
  border: 1px solid rgba(212,175,55,0.20);
  box-shadow: 0 10px 26px rgba(0,0,0,0.08);
">
  <h2 style="color:#b8860b; font-family:'Playfair Display',serif;">Deixe seu recado para a turma âœ¨</h2>

  <p style="color:#444; font-size:0.95rem; margin-top:4px;">
    Escreva uma mensagem especial e deixe sua assinatura â€” seu carinho ficarÃ¡ registrado em nosso livro de ouro virtual.
  </p>

  <!-- Campo do nome -->
  <input id="nome" type="text" placeholder="Seu nome..." style="
      width:100%;
      margin-top:12px;
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.2);
      font-size:0.95rem;
  ">

  <!-- Campo de recado -->
  <textarea id="msg" placeholder="Escreva sua mensagem..." style="
      width:100%;
      height:120px;
      margin-top:12px;
      padding:12px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.2);
      font-size:0.95rem;
      resize:none;
  "></textarea>

  <!-- BotÃ£o -->
  <button onclick="enviarRecado()" style="
    margin-top:14px;
    background:#d4af37;
    color:white;
    padding:10px 16px;
    border:none;
    border-radius:8px;
    font-size:1rem;
    font-weight:700;
    cursor:pointer;
    width:100%;
  ">Enviar recado</button>

  <!-- Lista de recados -->
  <div id="lista-recados" style="
    margin-top:22px;
    text-align:left;
  "></div>
</section>

<script>
function enviarRecado(){
  const nome = document.getElementById("nome").value.trim();
  const msg = document.getElementById("msg").value.trim();

  if(!msg){
    alert("Digite uma mensagem antes de enviar!");
    return;
  }

  const box = document.getElementById("lista-recados");

  // Criar o cartÃ£o
  const rec = document.createElement("div");
  rec.style = `
    background:white; 
    padding:14px; 
    border-radius:8px; 
    margin-bottom:12px; 
    border:1px solid rgba(0,0,0,0.15); 
    box-shadow:0 4px 10px rgba(0,0,0,0.06);
  `;

  // Mensagem principal
  const textoMsg = document.createElement("p");
  textoMsg.style = "margin:0 0 6px 0; color:#333;";
  textoMsg.textContent = msg;

  // Assinatura
  const assinatura = document.createElement("p");
  assinatura.style = "margin:0; font-size:0.85rem; color:#666; text-align:right;";
  assinatura.textContent = nome ? `â€” ${nome}` : "â€” AnÃ´nimo";

  rec.appendChild(textoMsg);
  rec.appendChild(assinatura);

  // Adiciona no topo
  box.prepend(rec);

  // Limpa campos
  document.getElementById("msg").value = "";
  document.getElementById("nome").value = "";
}
</script>

  <footer>Com carinho, Turma 6 de Medicina â€” UNIVASF ðŸ’š</footer>

  <!-- SCRIPT: carregar CSV / fallback para HTML / desenhar nuvem -->
  <script>
  (function(){
    const csvUrlBase = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS07GYioWKYwAOFq2hc30euYOE5pqe4Ca3tCz1KscRnOH9t4AX2JbXBV3_hanDsb1nI7O-NrRQ8GOi_";
    const csvUrl = csvUrlBase + "/pub?output=csv";
    const pubhtmlUrl = csvUrlBase + "/pubhtml";

    const wcMsg = document.getElementById('wc-msg');
    const cloud = document.getElementById('wordcloud');

    // CSV parser que entende aspas
    function parseCSV(text){
      const rows = [];
      let cur=[], field='', inQuotes=false;
      for(let i=0;i<text.length;i++){
        const ch = text[i], nxt = text[i+1];
        if(inQuotes){
          if(ch === '"' && nxt === '"'){ field += '"'; i++; continue; }
          if(ch === '"'){ inQuotes=false; continue; }
          field += ch;
        } else {
          if(ch === '"'){ inQuotes=true; continue; }
          if(ch === ','){ cur.push(field); field=''; continue; }
          if(ch === '\r') continue;
          if(ch === '\n'){ cur.push(field); rows.push(cur); cur=[]; field=''; continue; }
          field += ch;
        }
      }
      if(field !== '' || cur.length) { cur.push(field); rows.push(cur); }
      return rows;
    }

    // fallback: parse HTML page with table
    function parsePubHtml(htmlText){
      const doc = new DOMParser().parseFromString(htmlText, 'text/html');
      const table = doc.querySelector('table.wikitable, table'); // google uses table
      if(!table) return [];
      const rows = [];
      table.querySelectorAll('tr').forEach(tr=>{
        const cells = Array.from(tr.querySelectorAll('th,td')).map(td=>td.textContent.trim());
        rows.push(cells);
      });
      return rows;
    }

    // normalize header names and find indices
    function detectIndices(headerRow){
      const header = headerRow.map(h => (h||'').toString().toLowerCase().trim());
      const nomeIdx = header.findIndex(h => /nome|name|doador|doadores|contribu/i.test(h));
      const valorIdx = header.findIndex(h => /valor|value|amount|quantia|montante|contribuiÃ§Ã£o|contribuicao/i.test(h));
      return { nomeIdx: nomeIdx >=0 ? nomeIdx : 0, valorIdx: valorIdx >=0 ? valorIdx : 1 };
    }

    // try fetch CSV first; if fails or looks like HTML, try pubhtml
    async function fetchSheet(){
      try {
        console.log('Tentando CSV:', csvUrl);
        const r = await fetch(csvUrl);
        if(!r.ok) throw new Error('CSV fetch failed: '+r.status);
        const text = await r.text();
        // quick detect: if returned content contains HTML <table or <!doctype, treat as HTML
        if(/<html|<table/i.test(text) && text.length < 500000){
          console.warn('CSV response looks like HTML â€” fallback to pubhtml parsing');
          // try pubhtml
          const r2 = await fetch(pubhtmlUrl);
          if(!r2.ok) throw new Error('pubhtml fetch failed: '+r2.status);
          const html = await r2.text();
          const rows = parsePubHtml(html);
          return rows;
        }
        // otherwise parse CSV
        const rows = parseCSV(text);
        return rows;
      } catch(err){
        console.warn('CSV fetch failed, trying pubhtml:', err);
        try {
          const r = await fetch(pubhtmlUrl);
          if(!r.ok) throw new Error('pubhtml fetch failed: '+r.status);
          const html = await r.text();
          const rows = parsePubHtml(html);
          return rows;
        } catch(err2){
          console.error('Both CSV and pubhtml fetch failed:', err2);
          throw err2;
        }
      }
    }

    // sanitize numeric value strings to float
    function parseMoney(s){
      if(!s) return 0;
      let t = s.toString().trim();
      // remove currency symbols and spaces
      t = t.replace(/\s/g,'').replace(/R\$|BRL|USD|â‚¬/gi,'');
      // if uses coma decimal with dots as thousands: 1.234,56 -> remove dots, replace comma
      if(/,\d{1,2}$/.test(t) && /\./.test(t)){
        t = t.replace(/\./g,'').replace(',', '.');
      } else {
        // replace comma by dot if only comma present
        if(t.indexOf(',') !== -1 && t.indexOf('.') === -1) t = t.replace(',', '.');
        // remove any non numeric except dot and minus
      }
      t = t.replace(/[^\d\.\-]/g,'');
      const f = parseFloat(t);
      return isNaN(f)?0:f;
    }

    // main flow
    (async function main(){
      try {
        const rows = await fetchSheet();
        console.log('Rows loaded:', rows.length);
        if(!rows || rows.length < 2){
          wcMsg.textContent = 'Nenhum doador encontrado na planilha.';
          return;
        }

        // trim empty end rows
        const cleaned = rows.filter(r => r.some(c => (c||'').toString().trim() !== ''));

        if(cleaned.length < 2){
          wcMsg.textContent = 'Nenhum doador vÃ¡lido encontrado.';
          return;
        }

        const header = cleaned[0].map(h => (h||'').toString().trim());
        const { nomeIdx, valorIdx } = detectIndices(header);
        console.log('detected indices', {nomeIdx, valorIdx, header});

        const donors = [];
        for(let i=1;i<cleaned.length;i++){
          const row = cleaned[i];
          const nome = (row[nomeIdx] || '').toString().trim();
          const rawVal = (row[valorIdx] || '').toString().trim();
          const valor = parseMoney(rawVal);
          if(nome){
            donors.push({ nome, valor });
          }
        }

        if(donors.length === 0){
          wcMsg.textContent = 'Nenhum doador vÃ¡lido encontrado.';
          return;
        }

        wcMsg.textContent = ''; // remove mensagem
        drawCloud(donors);
      } catch(err){
        console.error(err);
        wcMsg.textContent = 'Erro ao carregar doadores. Veja console para detalhes.';
      }
    })();

    /* draw cloud with naive collision avoidance */
    function drawCloud(donors){
      const container = document.getElementById('wordcloud');
      container.innerHTML = '';
      const W = container.clientWidth;
      const H = container.clientHeight;

      const vals = donors.map(d => d.valor || 0);
      const min = Math.min(...vals);
      const max = Math.max(...vals);

      const placed = [];

      function collides(r){
        for(const p of placed){
          if(!(r.x + r.w < p.x || p.x + p.w < r.x || r.y + r.h < p.y || p.y + p.h < r.y)){
            return true;
          }
        }
        return false;
      }

      const shuffled = donors.slice().sort(()=>Math.random()-0.5);

      shuffled.forEach(d=>{
        // font size scaling
        let size;
        if(max === min){
          size = 14 + (d.valor>0?20:0);
        } else {
          const t = (d.valor - min) / (max - min);
          size = Math.round(12 + t * 44); // 12..56 px
        }

        const el = document.createElement('div');
        el.className = 'tag';
        el.textContent = d.nome;
        el.style.fontSize = size + 'px';
        el.style.lineHeight = '1';

        // append offscreen for measure
        el.style.left = '-9999px';
        el.style.top = '-9999px';
        container.appendChild(el);

        const rect = el.getBoundingClientRect();
        const elw = Math.ceil(rect.width);
        const elh = Math.ceil(rect.height);

        let placedRect = null;
        let attempts = 0;
        while(attempts < 160){
          const x = Math.floor(Math.random() * Math.max(1, W - elw));
          const y = Math.floor(Math.random() * Math.max(1, H - elh));
          const r = { x, y, w: elw + 6, h: elh + 6 };
          if(!collides(r)){
            placedRect = r;
            break;
          }
          attempts++;
        }

        if(!placedRect){
          // last-resort: place anyway (centerish)
          const x = Math.floor(Math.max(0, (W - elw) * Math.random()));
          const y = Math.floor(Math.max(0, (H - elh) * Math.random()));
          placedRect = { x, y, w: elw + 6, h: elh + 6 };
        }

        el.style.left = placedRect.x + 'px';
        el.style.top = placedRect.y + 'px';
        el.style.opacity = '0.95';

        // small floating animation with random duration/delay
       el.style.animation = "none";
        placed.push(placedRect);
      });

      }
    }

  })();
  </script>
</body>
</html>
